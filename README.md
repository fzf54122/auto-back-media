# ğŸš€ auto-back-media

<div align="center">

    **è‡ªåŠ¨åŒ–åª’ä½“å‘å¸ƒåç«¯é¡¹ç›®**

> **ğŸ‰ åŸºäº [FastAPI-Template](https://github.com/JiayuXu0/FastAPI-Template) åˆ›å»º**
>
> ğŸ’ **æ„Ÿè°¢åŸä½œè€…**: [@JiayuXu0](https://github.com/JiayuXu0) æä¾›çš„ä¼˜ç§€ä¼ä¸šçº§FastAPIæ¨¡æ¿
>
> ğŸŒŸ **å¦‚æœè¿™ä¸ªæ¨¡æ¿å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™åŸé¡¹ç›®ç‚¹ä¸ª Star**: [FastAPI-Template](https://github.com/JiayuXu0/FastAPI-Template)

---

**ç®€ä½“ä¸­æ–‡** | [English](README.en.md)

[![Python](https://img.shields.io/badge/Python-3.12+-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.100+-green.svg)](https://fastapi.tiangolo.com/)
[![License](https://img.shields.io/badge/License-Apache-2.0-yellow.svg)](https://opensource.org/licenses/Apache-2.0)

[![UV](https://img.shields.io/badge/ğŸ“¦_ä¾èµ–ç®¡ç†-UV-blueviolet.svg)](https://github.com/astral-sh/uv)
[![Architecture](https://img.shields.io/badge/ğŸ—ï¸_æ¶æ„-ä¸‰å±‚æ¶æ„-orange.svg)](#)
[![RBAC](https://img.shields.io/badge/ğŸ”_æƒé™-RBAC-red.svg)](#)
[![Docker](https://img.shields.io/badge/ğŸ³_å®¹å™¨-Docker-blue.svg)](https://www.docker.com/)

[ğŸ“– å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [ğŸ—ï¸ æ¶æ„è¯´æ˜](#-æ¶æ„è¯´æ˜) â€¢ [ğŸ“š å¼€å‘æŒ‡å—](CLAUDE.md) â€¢ [ğŸ¤ è´¡çŒ®æŒ‡å—](CONTRIBUTING.md)

</div>

---

## âœ¨ åŸºäºæ¨¡æ¿çš„æ ¸å¿ƒç‰¹æ€§

æœ¬é¡¹ç›®åŸºäº [FastAPI-Template](https://github.com/JiayuXu0/FastAPI-Template) æ„å»ºï¼Œå…·å¤‡ä»¥ä¸‹ä¼ä¸šçº§ç‰¹æ€§ï¼š

- ğŸ—ï¸ **ä¸‰å±‚æ¶æ„è®¾è®¡**  
  - API å±‚ï¼š`application.app_*` ä¸‹çš„ `apis` ç›®å½•ï¼Œè´Ÿè´£è·¯ç”±ã€è¯·æ±‚å‚æ•°éªŒè¯ã€è¿”å›æ ¼å¼åŒ–  
  - Service å±‚ï¼š`services` ç›®å½•ï¼Œè´Ÿè´£ä¸šåŠ¡é€»è¾‘å¤„ç†ã€æƒé™æ ¡éªŒã€æ“ä½œå°è£…  
  - Repository / Model å±‚ï¼š`models` ç›®å½•ï¼Œè´Ÿè´£æ•°æ®åº“è¡¨å®šä¹‰ä¸æ•°æ®è®¿é—®  

- ğŸ” **RBAC æƒé™ç®¡ç†**  
  - åŸºäºè§’è‰²ã€èœå•å’Œ API çš„æƒé™æ§åˆ¶  
  - `PermissionControl` ç±»å®ç° API æƒé™éªŒè¯  
  - `AgentPermissionControl` æ”¯æŒæ™ºèƒ½ä½“èµ„æºçº§æƒé™æ§åˆ¶  
  - è¶…çº§ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œè·¯å¾„å‚æ•°æ”¯æŒæ­£åˆ™åŒ¹é…  

- ğŸ‘¤ **ç”¨æˆ·è®¤è¯ä¸ JWT ç®¡ç†**  
  - `AuthControl` ç±»æ”¯æŒ JWT éªŒè¯  
  - æ”¯æŒ access_token / refresh_token ç®¡ç†  
  - Redis é»‘åå•æœºåˆ¶æ”¯æŒç™»å‡º token å¤±æ•ˆ  

- ğŸ“ **å®¡è®¡æ—¥å¿—ä¸æ“ä½œè¿½è¸ª**  
  - `AuditLog` æ¨¡å‹è®°å½•æ“ä½œæ—¥å¿—  
  - æ‰€æœ‰å…³é”®æ“ä½œå’Œç”¨æˆ·è¡Œä¸ºå‡å¯è¿½æº¯  

- ğŸš€ **Redis ç¼“å­˜ä¼˜åŒ–**  
  - ä½¿ç”¨ `cache_manager` æä¾›ç¼“å­˜ç­–ç•¥  
  - å¯ç”¨äº token é»‘åå•ã€å¸¸ç”¨æ•°æ®ç¼“å­˜ç­‰  

- ğŸ“ **æ–‡ä»¶ä¸Šä¼ ä¸ç®¡ç†**  
  - æ”¯æŒå®‰å…¨æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½  
  - å¯æ‰©å±•çš„æ–‡ä»¶å­˜å‚¨æ–¹æ¡ˆ  

- ğŸ“Š **åˆ†é¡µä¸è¿‡æ»¤**  
  - DRF é£æ ¼ GenericViewSet æ”¯æŒåˆ†é¡µã€è¿‡æ»¤ã€æ’åº  
  - è‡ªå®šä¹‰ FilterSet å¯çµæ´»æ‰©å±•  

- ğŸ³ **Docker å®¹å™¨åŒ–éƒ¨ç½²**  
  - æ”¯æŒ Docker Compose ä¸€é”®å¯åŠ¨æœåŠ¡  
  - å¯è½»æ¾éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ  

- ğŸ“– **è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£**  
  - Swagger UI å’Œ ReDoc æ–‡æ¡£ç”Ÿæˆ  
  - æ”¯æŒ summaryã€descriptionã€example è‡ªåŠ¨æå–  

- ğŸ”§ **ä»£ç è´¨é‡ä¿éšœ**  
  - Pre-commit hooks + Ruff  
  - è‡ªåŠ¨æ ¼å¼åŒ–ä¸ä»£ç æ£€æŸ¥  

- ğŸ“„ **å®Œæ•´é¡¹ç›®æ–‡æ¡£**  
  - MkDocs æä¾›å¼€å‘æ–‡æ¡£ä¸æ¥å£è¯´æ˜  
  - å¯æ‰©å±•çš„æ–‡æ¡£ç›®å½•ç»“æ„  
  
---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“‹ ç¯å¢ƒè¦æ±‚

- Python 3.12+
- UV (æ¨è) æˆ– pip
- PostgreSQL 12+
- Redis 6+

### ğŸ› ï¸ å®‰è£…éƒ¨ç½²

1. **å®‰è£…ä¾èµ–**

   ```bash
   # å®‰è£… UV (æ¨è)
   curl -LsSf https://astral.sh/uv/install.sh | sh

   # å®‰è£…é¡¹ç›®ä¾èµ–
   uv sync --dev
   ```
2. **ç¯å¢ƒé…ç½®**

   ```bash
   span
   ```
3. **æ•°æ®åº“åˆå§‹åŒ–**

   ```bash
   # åˆå§‹åŒ–æ•°æ®åº“
   uv run aerich init-db

   # åº”ç”¨è¿ç§»
   uv run aerich upgrade
   ```
4. **å¯åŠ¨æœåŠ¡**

   ```bash
   # å¼€å‘ç¯å¢ƒå¯åŠ¨
   uv run uvicorn application:app --reload --host 0.0.0.0 --port 8000
   ```
5. **è®¿é—®åº”ç”¨**

   - **APIæ–‡æ¡£**: http://localhost:8000/docs
   - **ReDocæ–‡æ¡£**: http://localhost:8000/redoc
   - **å¥åº·æ£€æŸ¥**: http://localhost:8000/api/v1/base/health

### ğŸ”‘ é»˜è®¤è´¦æˆ·

- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `abcd1234`
- **é‚®ç®±**: `admin@admin.com`

âš ï¸ **é‡è¦**: ç”Ÿäº§ç¯å¢ƒè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

---

## ğŸ—ï¸ æ¶æ„è¯´æ˜

é¡¹ç›®é‡‡ç”¨ç»å…¸çš„ä¸‰å±‚æ¶æ„è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API Layer                            â”‚
â”‚  (application/*/apis/) - è·¯ç”±æ³¨å†Œã€è¯·æ±‚å¤„ç†ã€å‚æ•°æ ¡éªŒã€å“åº”å°è£… â”‚
â”‚  åŸºäºè‡ªå®šä¹‰ GenericViewSet + Mixins å®ç° DRF é£æ ¼æ¥å£           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Service Layer                          â”‚
â”‚  (application/*/services/) - ä¸šåŠ¡é€»è¾‘å¤„ç†ã€æƒé™æ ¡éªŒã€è°ƒç”¨æ¨¡å‹   â”‚
â”‚  æ”¯æŒ JWT éªŒè¯ã€RBACã€æ™ºèƒ½ä½“èµ„æºæƒé™                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Model Layer                             â”‚
â”‚  (application/*/models/) - æ•°æ®æ¨¡å‹å±‚ï¼ŒTortoise ORM æ¨¡å‹å®šä¹‰ â”‚
â”‚  ManyToMany / ForeignKey / CRUD æ“ä½œï¼Œæ”¯æŒå¼‚æ­¥æŸ¥è¯¢           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Schema Layer                            â”‚
â”‚  (application/*/schemas/) - Pydantic Schemasï¼Œæ•°æ®éªŒè¯ã€åºåˆ—åŒ–â”‚
â”‚  è‡ªåŠ¨ç”Ÿæˆ Swagger / ReDoc æ–‡æ¡£                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Commons / Utilities                     â”‚
â”‚  (commons/core/ & commons/drf/) - é€šç”¨å·¥å…·ã€åˆ†é¡µã€æ’åºã€æ—¥å¿— â”‚
â”‚  è‡ªå®šä¹‰ DRF é£æ ¼ GenericViewSet & Mixinsï¼Œç¼“å­˜ã€JWT ç­‰åŠŸèƒ½   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

---

## ğŸ“š å¼€å‘æŒ‡å—

### å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘æœåŠ¡å™¨
uv run uvicorn backend:app --reload

# ä»£ç æ ¼å¼åŒ–
uv run ruff format backend/

# ä»£ç æ£€æŸ¥
uv run ruff check --fix backend/

# è¿è¡Œæµ‹è¯•
uv run pytest

# æ•°æ®åº“è¿ç§»
uv run aerich migrate --name "describe_changes"
uv run aerich upgrade
# æ–‡æ¡£æœåŠ¡
uv run mkdocs serve
```

### é¡¹ç›®ç»“æ„

```
auto-back-media/
â”œâ”€â”€ aerich_config.py # Tortoise ORM/Aerich é…ç½®
â”œâ”€â”€ application/ # æ ¸å¿ƒåº”ç”¨ç›®å½•
â”‚ â”œâ”€â”€ app_base/ # åŸºç¡€æ¨¡å—
â”‚ â”‚ â”œâ”€â”€ apis/ # API å±‚
â”‚ â”‚ â”œâ”€â”€ models/ # æ•°æ®æ¨¡å‹
â”‚ â”‚ â”œâ”€â”€ schemas/ # Pydantic Schemas
â”‚ â”‚ â”œâ”€â”€ services/ # Service å±‚
â”‚ â”‚ â”œâ”€â”€ filters.py # è‡ªå®šä¹‰è¿‡æ»¤å™¨
â”‚ â”‚ â””â”€â”€ utils.py # å·¥å…·å‡½æ•°
â”‚ â”œâ”€â”€ app_system/ # ç³»ç»Ÿæ¨¡å—ï¼ˆç”¨æˆ·ã€æƒé™ã€ç™»å½•ç­‰ï¼‰
â”‚ â”‚ â”œâ”€â”€ apis/
â”‚ â”‚ â”œâ”€â”€ models/
â”‚ â”‚ â”œâ”€â”€ schemas/
â”‚ â”‚ â”œâ”€â”€ services/
â”‚ â”‚ â””â”€â”€ urls.py # ç³»ç»Ÿè·¯ç”±æ³¨å†Œ
â”‚ â”œâ”€â”€ app_manage/ # ç®¡ç†æ¨¡å—ï¼ˆå¯æ‰©å±•ä¸šåŠ¡ï¼‰
â”‚ â”‚ â”œâ”€â”€ apis/
â”‚ â”‚ â”œâ”€â”€ models/
â”‚ â”‚ â”œâ”€â”€ schemas/
â”‚ â”‚ â””â”€â”€ services/
â”‚ â”œâ”€â”€ apis.py # å…¨å±€ API æ±‡æ€»
â”‚ â”œâ”€â”€ authentication.py # JWT/æƒé™æ§åˆ¶
â”‚ â”œâ”€â”€ models.py # å…¨å±€æ¨¡å‹
â”‚ â”œâ”€â”€ pagination.py # åˆ†é¡µå·¥å…·
â”‚ â””â”€â”€ utils.py # å…¨å±€å·¥å…·
â”œâ”€â”€ commons/ # å…¬å…±åº“
â”‚ â”œâ”€â”€ core/ # æ ¸å¿ƒåŠŸèƒ½ï¼šJWTã€ç¼“å­˜ã€å“åº”ã€æƒé™ç­‰
â”‚ â”œâ”€â”€ drf/ # è‡ªå®šä¹‰ DRF é£æ ¼ GenericViewSet & Mixins
â”‚ â””â”€â”€ logger/ # æ—¥å¿—å¤„ç†
â”œâ”€â”€ conf/ # é…ç½®ç›®å½•
â”‚ â””â”€â”€ config.py
â”œâ”€â”€ deploy-docs.sh # éƒ¨ç½²æ–‡æ¡£/è„šæœ¬
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ logs/ # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ mkdocs.yml # é¡¹ç›®æ–‡æ¡£é…ç½®
â”œâ”€â”€ plugins/ # å¯æ‰©å±•æ’ä»¶ç›®å½•
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ README.md
â”œâ”€â”€ scripts/ # è¾…åŠ©è„šæœ¬
â””â”€â”€ uv.lock # UV ä¾èµ–é”æ–‡ä»¶
```
### è¯´æ˜

- **API å±‚ (`apis`)**ï¼šè´Ÿè´£è¯·æ±‚è·¯ç”±ã€å‚æ•°æ ¡éªŒã€è¿”å›å°è£…ï¼›ç»§æ‰¿è‡ª `GenericViewSet` å’Œè‡ªå®šä¹‰ mixinsï¼ŒDRF é£æ ¼ã€‚  
- **Service å±‚ (`services`)**ï¼šå°è£…ä¸šåŠ¡é€»è¾‘ã€æƒé™éªŒè¯ã€è°ƒç”¨æ¨¡å‹ã€‚  
- **Model å±‚ (`models`)**ï¼šTortoise ORM æ¨¡å‹ï¼Œæ”¯æŒ ManyToManyã€ForeignKey å…³ç³»ã€‚  
- **Schemas å±‚ (`schemas`)**ï¼šPydantic æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–ï¼Œæ”¯æŒè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ã€‚  
- **Commons/drf**ï¼šå®ç°äº†ç±»ä¼¼ Django REST Framework çš„ ViewSetã€Create/Update/Delete mixinsï¼Œæ”¯æŒåˆ†é¡µã€æ’åºã€è¿‡æ»¤ã€‚  
- **authentication.py**ï¼šé›†ä¸­ç®¡ç† JWT éªŒè¯ã€æƒé™æ§åˆ¶å’Œæ™ºèƒ½ä½“èµ„æºæƒé™ã€‚  
- **Redis & ç¼“å­˜**ï¼š`cache_manager` æä¾› token é»‘åå•åŠå…¶ä»–ç¼“å­˜æœåŠ¡ã€‚  
---

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº Apache-2.0 è®¸å¯è¯å¼€æº - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

---

## ğŸ™ è‡´è°¢

- **æ¨¡æ¿æ¥æº**: [FastAPI-Template](https://github.com/JiayuXu0/FastAPI-Template) by [@JiayuXu0](https://github.com/JiayuXu0)
- **æŠ€æœ¯æ ˆ**: [FastAPI](https://fastapi.tiangolo.com/), [Tortoise ORM](https://tortoise-orm.readthedocs.io/), [UV](https://github.com/astral-sh/uv)
- **ä½œè€…**: fzf (fzf54122@163.com)

---

<div align="center">

**ğŸŒŸ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œåˆ«å¿˜äº†ç»™åŸæ¨¡æ¿é¡¹ç›®ç‚¹ä¸ª Starï¼**

**[â­ FastAPI-Template](https://github.com/JiayuXu0/FastAPI-Template)**

**æ„Ÿè°¢ [@JiayuXu0](https://github.com/JiayuXu0) çš„ä¼˜ç§€å·¥ä½œï¼**

</div>
